# 匿名投票功能测试计划

## 测试目标
验证反馈页面投票功能的修改是否正确实现：
- 匿名用户可以点踩（无需登录）
- 已登录用户点赞需要登录验证
- 防重复投票机制有效
- 数据一致性和用户体验

## 测试环境准备
1. 启动后端服务：`npm run server`
2. 启动前端服务：`npm run dev`
3. 确保MongoDB数据库运行
4. 准备测试数据（反馈条目）

## 测试用例

### 1. 匿名用户点踩测试
**目标**：验证匿名用户可以直接点踩

**步骤**：
1. 清除浏览器localStorage和cookies
2. 访问反馈页面（不登录）
3. 点击任意反馈的"踩"按钮
4. 观察是否成功投票

**预期结果**：
- 无需登录提示
- 点踩数量增加1
- 按钮状态变为已点踩
- 设备指纹生成并缓存到localStorage

**验证点**：
- localStorage中存在'deviceFingerprint'
- 网络请求包含deviceId字段
- 后端返回成功响应

### 2. 匿名用户点赞测试
**目标**：验证匿名用户点赞需要登录

**步骤**：
1. 确保未登录状态
2. 点击任意反馈的"赞"按钮
3. 观察系统响应

**预期结果**：
- 显示"请先登录后再点赞"错误提示
- 点赞数量不变
- 按钮状态不变

### 3. 已登录用户投票测试
**目标**：验证已登录用户的完整投票功能

**步骤**：
1. 登录用户账号
2. 分别测试点赞和点踩功能
3. 测试取消投票功能
4. 测试切换投票类型

**预期结果**：
- 点赞和点踩都能正常工作
- 投票计数正确更新
- 用户投票状态正确显示
- 网络请求包含Authorization头

### 4. 防重复投票测试
**目标**：验证同一用户不能重复投票

**步骤**：
1. 匿名用户点踩某个反馈
2. 刷新页面，再次点踩同一反馈
3. 清除localStorage，重新生成设备指纹，再次点踩
4. 登录用户投票后，再次投票

**预期结果**：
- 同一设备指纹不能重复投票
- 已投票的反馈显示正确状态
- 重复投票时显示适当提示或取消投票

### 5. 数据一致性测试
**目标**：验证前后端数据同步

**步骤**：
1. 执行各种投票操作
2. 检查数据库中的投票记录
3. 验证前端显示与数据库一致

**预期结果**：
- voters数组包含正确的userId或deviceId
- upvotes和downvotes计数准确
- 前端状态与数据库同步

### 6. 边界情况测试
**目标**：测试异常情况处理

**测试场景**：
- 网络中断时投票
- 无效的反馈ID
- 损坏的设备指纹
- 并发投票请求

**预期结果**：
- 适当的错误提示
- 系统不崩溃
- 数据保持一致性

## 测试检查清单

### 前端功能
- [ ] 匿名用户可以点踩
- [ ] 匿名用户点赞被阻止
- [ ] 已登录用户可以点赞和点踩
- [ ] 投票状态正确显示
- [ ] 错误提示准确
- [ ] UI交互流畅

### 后端API
- [ ] 支持无token的点踩请求
- [ ] 阻止无token的点赞请求
- [ ] 正确处理deviceId参数
- [ ] 防重复投票机制有效
- [ ] 错误响应格式正确

### 数据库
- [ ] voters数组结构正确
- [ ] userId和deviceId字段正确保存
- [ ] 投票计数准确
- [ ] 数据索引正常工作

### 兼容性
- [ ] 现有已登录用户功能不受影响
- [ ] 现有投票数据完整性保持
- [ ] 其他需要认证的功能正常

## 测试结果记录

### 发现的问题
（记录测试过程中发现的问题）

### 修复措施
（记录问题的修复方案）

### 最终验证
（记录最终验证结果）
