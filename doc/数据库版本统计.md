# 数据库版本统计功能

## 功能概述

数据库版本统计功能用于收集和分析用户使用的 IndexedDB 数据库版本信息。这有助于开发团队了解用户群体中不同版本的分布情况，从而做出更好的升级和兼容性决策。

## 实现原理

1. **客户端收集**：

   - 在应用程序启动时，通过`checkAndUpgradeDatabase`函数检查当前用户的数据库版本
   - 收集设备 ID、当前版本、期望版本等信息
   - 将这些信息发送到服务器端 API

2. **服务器端存储**：

   - 接收客户端上报的数据库版本信息
   - 将信息存储在 MongoDB 数据库中
   - 提供 API 接口查询统计数据

3. **管理界面展示**：
   - 提供管理员界面展示版本分布情况
   - 显示需要升级的用户比例
   - 提供详细的设备列表和版本信息

## 数据模型

数据库版本统计信息使用以下模型存储：

```typescript
interface IDbStats {
  deviceId: string; // 设备唯一标识
  currentVersion: number; // 当前数据库版本
  expectedVersion: number; // 期望的数据库版本
  timestamp: Date; // 上报时间
  userAgent: string; // 浏览器信息
}
```

## 访问管理页面

管理页面位于`/admin`路径下，只有管理员可以访问。页面显示：

1. 总设备数
2. 使用最新版本的比例
3. 需要升级的设备数
4. 各版本的分布情况
5. 详细的设备列表

## 注意事项

- 数据收集遵循隐私原则，不收集用户个人信息
- 设备 ID 使用随机生成的标识符，不与用户账号关联
- 管理页面需要管理员权限才能访问

## 未来改进

1. 添加数据导出功能，支持 CSV 格式导出
2. 实现自动通知功能，当有大量用户需要升级时发送提醒
3. 添加按版本、时间等维度的筛选功能
4. 实现数据可视化图表，更直观地展示版本分布
