# 自定义文章保存逻辑优化

## 问题描述

原有的自定义文章功能存在保存逻辑问题：
- 保存文章的按钮只在练习完成后显示
- 用户必须完成整篇文章练习才能保存
- 如果用户中途想保存文章但还没完成练习，就无法保存
- 不符合用户的使用习惯和预期

## 优化方案

将保存文章的功能从练习完成后移动到预处理阶段（第二步），让用户可以在确定文章内容和预处理设置后就保存文章。

## 实施内容

### 1. 修改ArticlePreprocess组件
- 添加了保存文章的状态管理（isSaving）
- 导入了useSaveArticle hook
- 实现了handleSave函数，保存原始文章内容（articleText）
- 在按钮区域添加了"保存文章"按钮
- 改进了文章标题生成逻辑

### 2. 修改ArticlePractice组件
- 移除了useSaveArticle导入和相关状态
- 删除了handleSave函数
- 将练习完成后的"保存文章"按钮替换为"返回设置"按钮
- 简化了结果页面的按钮布局

### 3. 优化状态管理
- 在PREV_STEP action中添加了保存状态重置逻辑
- 确保返回上一步时重置isSaved状态

## 优化效果

1. **更好的用户体验**：用户可以在预处理阶段就保存文章，不需要完成练习
2. **更合理的保存时机**：在确定文章内容和设置后保存，符合用户预期
3. **保存原始内容**：保存用户输入的原始文章内容，而不是处理后的内容
4. **简化练习流程**：练习完成后专注于结果展示，不再有保存干扰

## 技术细节

- 保存的是`state.articleText`（原始内容）而不是`state.processedText`（处理后内容）
- 文章标题生成逻辑：取前30个字符，超过则添加省略号，空白则使用"未命名文章"
- 保存状态在步骤切换时正确重置
- 保持了原有的保存成功/失败反馈机制

## 测试验证

- 项目成功启动在 http://localhost:3001/
- 自定义文章页面可正常访问：http://localhost:3001/custom-article
- 编译无错误，功能逻辑正确

## 后续优化（用户反馈）

### 1. 悬浮保存文章按钮
- **问题**：原来的按钮在页面右上角，不够显眼；"历史记录"术语容易误导用户
- **优化**：改为右边中间位置的悬浮按钮，更名为"保存的文章"
- **实现**：使用fixed定位，添加图标和文字标签，提供清晰的功能说明

### 2. 避免重复保存
- **问题**：从保存的文章列表进入练习时仍显示保存按钮，可能导致重复保存
- **优化**：从保存的文章列表进入时不显示保存功能
- **实现**：
  - 添加`fromHistory`状态跟踪来源
  - 在ArticleHistory中设置标志
  - 在ArticlePreprocess中根据标志隐藏保存按钮
  - 返回第一步时重置标志

### 3. 术语优化
- **问题**："历史记录"容易误导用户，暗示所有练习过的文章都会被记录
- **优化**：改为"保存的文章"，明确只显示用户主动保存的文章
- **实现**：更新按钮文字、页面标题和相关注释

### 技术实现细节

1. **新增状态字段**：
   ```typescript
   fromHistory: boolean; // 是否从历史记录进入练习
   ```

2. **新增Action类型**：
   ```typescript
   SET_FROM_HISTORY = "SET_FROM_HISTORY"
   ```

3. **悬浮按钮样式**：
   ```css
   fixed right-6 top-1/2 transform -translate-y-1/2
   bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full
   shadow-lg transition-all duration-200 z-50
   ```

4. **条件渲染保存按钮**：
   ```typescript
   {!state.fromHistory && (
     <button>保存文章</button>
   )}
   ```

5. **术语统一**：
   - 按钮文字：从"历史记录"改为"保存的文章"
   - 页面标题：从"文章历史"改为"保存的文章"
   - 提示文字：从"查看历史记录"改为"查看保存的文章"

## 执行日期

2025-01-16（初始优化）
2025-01-16（用户反馈优化）
